<?xml version="1.0" encoding="UTF-8"?>

<odoo>
    <data noupdate="0">

        <!-- Heredando vista form de ventas -->
        <record id="view_order_form_inherit" model="ir.ui.view">
            <field name="name">view_order_form_inherit</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale.view_order_form"/>
            <field name="arch" type="xml">

                <xpath expr="//field[@name='partner_shipping_id']" position="after">
                    <field name="xas_tracking_id" force_save="1" readonly="0"/>
                    <field name="xas_trip_number_id" force_save="1" readonly="1"/>
                </xpath>

                <xpath expr="//field[@name='product_template_id']" position="after">
                    <field name="xas_tracking_id" optional="show" force_save="1" readonly="0"/>
                    <field name="xas_trip_number_id" optional="show" force_save="1" readonly="1"/>
                </xpath>

            </field>
        </record>

        <!-- Acción de servidor para confirmar ventas en tree view -->
        <record id="action_confirm_multiple_sales" model="ir.actions.server">
            <field name="name">Confirmar Múltiples Ventas</field>
            <field name="model_id" ref="sale.model_sale_order"/>
            <field name="binding_model_id" ref="sale.model_sale_order"/>
            <field name="state">code</field>
            <field name="code">
                if records:
                    for sale in records:
                        if sale.state not in ['sale', 'done', 'cancel']:
                            sale.with_context(evade_distribution_notice=True).action_confirm()
            </field>
        </record>

        <!-- Herencia de vista busqueda para Ordenes -->
        <record id="sale_order_view_search_inherit_sale_inherit" model="ir.ui.view">
            <field name="name">sale_order_view_search_inherit_sale_inherit</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale.sale_order_view_search_inherit_sale"/>
            <field name="arch" type="xml">
                <field name="name" position="after">
                    <field name="xas_tracking_id"/>
                    <field name="xas_trip_number_id"/>
                </field>
                <xpath expr="//group" position="inside">
                    <filter string="Id de seguimiento" name="xas_tracking_id" domain="[]" context="{'group_by': 'xas_tracking_id'}"/>
                    <filter string="Código de embarque" name="xas_trip_number_id" domain="[]" context="{'group_by': 'xas_trip_number_id'}"/>
                </xpath>
            </field>
        </record>

        <!-- Herencia de vista busqueda para Cotizaciones -->
        <record id="sale_order_view_search_inherit_quotation_inherit" model="ir.ui.view">
            <field name="name">sale_order_view_search_inherit_quotation_inherit</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale.sale_order_view_search_inherit_quotation"/>
            <field name="arch" type="xml">
                <field name="name" position="after">
                    <field name="xas_tracking_id"/>
                    <field name="xas_trip_number_id"/>
                </field>
                <xpath expr="//group" position="inside">
                    <filter string="Id de seguimiento" name="xas_tracking_id" domain="[]" context="{'group_by': 'xas_tracking_id'}"/>
                    <filter string="Código de embarque" name="xas_trip_number_id" domain="[]" context="{'group_by': 'xas_trip_number_id'}"/>
                </xpath>
            </field>
        </record>
    </data>
</odoo>